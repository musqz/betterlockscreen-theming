#!/usr/bin/env bash 

# Configuratie
CONFIG_DIR="$HOME/.config/betterlockscreen"
THEMES_DIR="$CONFIG_DIR/themes"
ICON="$HOME/.icons/mabox-logo-3d.svg"

# Detecteer language
LANG_SHORT="${LANG:0:2}"

# Dependency check
command -v yad >/dev/null 2>&1 || {
    echo "Error: yad is not installed." >&2
    exit 1
}

command -v betterlockscreen >/dev/null 2>&1 || {
    echo "Warning: betterlockscreen not found. Some actions won't work." >&2
}

case "$LANG_SHORT" in
    nl)
        TITLE="Betterlockscreen Thema Manager"
        TXT_CHOOSE_ACTION="Kies een actie:"
        TXT_SELECT_THEME="Thema Kiezen"
        TXT_REGENERATE="Genereer Thema"
        TXT_HELP="Help"
        TXT_EXIT="Afsluiten"
        TXT_OK="Sluiten"
        TXT_CHOOSE_THEME="Kies een bestaand thema:"
        TXT_NO_THEMES="Geen thema's gevonden in $THEMES_DIR"
        TXT_HELP_TEXT="<b>[TRAAG PROCES] betterlockscreen -u [afbeeldingspad]:</b> \n 
	Deze opdracht werkt de vergrendelschermafbeelding bij, 
	inclusief het toepassen van wijzigingen voor loginbox-achtergrond en schaduw. \n
<b>[SNEL PROCES] betterlockscreen -l:</b> \n
	Bekijk onmiddellijk nieuwe wijzigingen, zoals het lettertype. 
	Loginbox-achtergrond en schaduw zijn uitgesloten. \n"
        ;;
    pl)
        TITLE="Mened≈ºer Motyw√≥w Betterlockscreen"
        TXT_CHOOSE_ACTION="Wybierz akcjƒô:"
        TXT_SELECT_THEME="Wybierz Motyw"
        TXT_REGENERATE="Generuj Motyw"
        TXT_HELP="Pomoc"
        TXT_EXIT="Zako≈Ñcz"
        TXT_OK="Zamknij"
        TXT_CHOOSE_THEME="Wybierz istniejƒÖcy motyw:"
        TXT_NO_THEMES="Nie znaleziono motyw√≥w w $THEMES_DIR"
        TXT_HELP_TEXT="<b>[WOLNY PROCES] betterlockscreen -u [≈õcie≈ºka_do_obrazu]:</b> \n 
	Ta komenda aktualizuje obraz ekranu blokady, 
	w tym zastosowanie zmian dla t≈Ça i cienia loginboxa. \n
<b>[SZYBKI PROCES] betterlockscreen -l:</b> \n
	Natychmiastowe wy≈õwietlenie nowych zmian, takich jak czcionka. 
	Z wy≈ÇƒÖczeniem t≈Ça i cienia loginboxa. \n"
        ;;
    es)
        TITLE="Betterlockscreen Gestor de Temas"
        TXT_CHOOSE_ACTION="Elige una acci√≥n:"
        TXT_SELECT_THEME="Seleccionar Tema"
        TXT_REGENERATE="Generar Tema"
        TXT_HELP="Ayuda"
        TXT_EXIT="Salir"
        TXT_OK="Cerrar"
        TXT_CHOOSE_THEME="Selecciona un tema existente:"
        TXT_NO_THEMES="No se encontraron temas en $THEMES_DIR"
        TXT_HELP_TEXT="<b>[PROCESO LENTO] betterlockscreen -u [ruta_de_imagen]:</b> \n 
	Este comando actualiza la imagen de la pantalla de bloqueo, 
	incluyendo la aplicaci√≥n de cambios en el fondo y la sombra del loginbox. \n
<b>[PROCESO R√ÅPIDO] betterlockscreen -l:</b> \n
	Visualiza inmediatamente los nuevos cambios, como la fuente. 
	Se excluyen el fondo y la sombra del loginbox. \n"
        ;;
    *)
        TITLE="Betterlockscreen Theme Manager"
        TXT_CHOOSE_ACTION="Choose an action:"
        TXT_SELECT_THEME="Select Theme"
        TXT_REGENERATE="Generate Theme"
        TXT_HELP="Tips and Tricks"
        TXT_EXIT="Exit"
        TXT_OK="Close"
        TXT_CHOOSE_THEME="Choose an existing theme:"
        TXT_NO_THEMES="No themes found in $THEMES_DIR"
        TXT_HELP_TEXT="<b>[SLOW PROCESS]  betterlockscreen -u [image_path]:</b> \n 
	This command updates your lockscreen image, 
	including applaying changes for loginbox background and shadow. \n
<b>[QUICK PROCESS] betterlockscreen -l:</b> \n
	See instantly new changes, like font. 
	Excluded loginbox background and shadow. \n"

        ;;
esac

# üìò Functies

show_help() {
    yad   --center --title="$TXT_HELP" \
      --window-icon=$ICON \
        --text="$TXT_HELP_TEXT" --button="$TXT_OK:0"
}

show_main_menu() {
    local choice
    choice=$(yad --width=350 --height=100 --center --title="$TITLE" \
        --window-icon=$ICON \
        --text="<b>$TITLE</b>\n\n$TXT_CHOOSE_ACTION" \
        --button="üé® $TXT_SELECT_THEME:1" \
        --button="üõ†Ô∏è $TXT_REGENERATE:2" \
        --button="üõà $TXT_HELP:3" \
        --button="üö™ $TXT_EXIT:0")

    case $? in
        1) betterlock-themes ; betterlock-menu ;;
        2) betterlock-theme-generator ; betterlock-menu ;;
        3) show_help; show_main_menu ;;
        0) exit 0 ;;
    esac
}

# Start
show_main_menu
